<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Question Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        textarea {
            width: 100%;
            height: 300px;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background-color: #45a049;
        }

        .question-editor {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .choices {
            margin: 10px 0;
        }

        select {
            padding: 5px;
            margin: 5px 0;
        }

        @media (max-width: 600px) {
            textarea {
                height: 200px;
            }
            
            button {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="section" id="inputSection">
            <h2>Input JSON</h2>
            <textarea id="jsonInput" placeholder="Paste your JSON here..."></textarea>
            <button onclick="handleEdit()">Edit</button>
        </div>

        <div class="section" id="editorSection" style="display: none;">
            <h2>Edit Questions</h2>
            <div id="editorContainer"></div>
            <button onclick="generateCorrectedJSON()">Generate</button>
        </div>

        <div class="section" id="resultSection" style="display: none;">
            <h2>Final Output</h2>
            <textarea id="output" readonly></textarea>
            <button onclick="copyToClipboard()">Copy Code</button>
        </div>
    </div>

    <script>
        let originalData = null;

        function handleEdit() {
            const jsonInput = document.getElementById('jsonInput').value;
            try {
                originalData = JSON.parse(jsonInput);
                buildEditorUI(originalData.question_paper.questions);
                document.getElementById('editorSection').style.display = 'block';
                document.getElementById('inputSection').style.display = 'none';
            } catch (e) {
                alert('Invalid JSON: ' + e.message);
            }
        }

        function buildEditorUI(questions) {
            const editorContainer = document.getElementById('editorContainer');
            editorContainer.innerHTML = '';

            questions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-editor';

                questionDiv.innerHTML = `
                    <h3>Question ${question.question_number}</h3>
                    <p>${question.question_text}</p>
                    <div class="choices">
                        ${Object.entries(question.choices).map(([key, value]) => `
                            <div>${key}: ${value}</div>
                        `).join('')}
                    </div>
                    <label>Correct Answer:
                        <select class="correct-option">
                            ${['A', 'B', 'C', 'D', 'X'].map(opt => `
                                <option value="${opt}" ${opt === question.correct_option ? 'selected' : ''}>
                                    ${opt}
                                </option>
                            `).join('')}
                        </select>
                    </label>
                `;

                editorContainer.appendChild(questionDiv);
            });
        }

        async function generateCorrectedJSON() {
            const editorQuestions = document.querySelectorAll('.question-editor');
            const newQuestions = [];

            editorQuestions.forEach((questionDiv, index) => {
                const select = questionDiv.querySelector('.correct-option');
                const selectedOption = select.value;

                if (selectedOption !== 'X') {
                    const originalQuestion = originalData.question_paper.questions[index];
                    newQuestions.push({
                        ...originalQuestion,
                        correct_option: selectedOption
                    });
                }
            });

            originalData.question_paper.questions = newQuestions;
            const correctedJSON = JSON.stringify(originalData, null, 2);

            try {
                const response = await fetch('https://raw.githubusercontent.com/developeranaz/developeranaz.github.io/refs/heads/gh-pages/webapps/quiz/KPSC/civil/065_2021/index.html');
                const templateText = await response.text();
                const finalCode = templateText.replace('PASTE_YOUR_JSON', correctedJSON);
                
                const output = document.getElementById('output');
                output.value = finalCode;
                document.getElementById('resultSection').style.display = 'block';
                document.getElementById('editorSection').style.display = 'none';
            } catch (error) {
                alert('Error fetching template: ' + error.message);
            }
        }

        async function copyToClipboard() {
            const output = document.getElementById('output');
            try {
                await navigator.clipboard.writeText(output.value);
                alert('Copied to clipboard!');
            } catch (err) {
                alert('Failed to copy: ' + err);
            }
        }
    </script>
</body>
</html>
